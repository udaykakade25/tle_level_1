create table borrower (
  roll_no varchar(10),
  name varchar(50),
  dateofissue date,
  nameofbook varchar(50),
  status varchar(20)
);

create table fine (
  roll_no varchar(10),
  date date,
  amt number
);
/

create or replace procedure return_book(p_roll borrower.roll_no%type, p_book borrower.nameofbook%type) is
  v_date_issue date;
  v_days number;
  v_fine number := 0;
  ex_book_not_found exception;
begin
  select dateofissue into v_date_issue from borrower
  where roll_no = p_roll and nameofbook = p_book;

  v_days := trunc(sysdate - v_date_issue);

  if v_days > 30 then
    v_fine := (v_days - 30) * 50 + (30 * 5);
  elsif v_days >= 15 then
    v_fine := v_days * 5;
  end if;

  if v_fine > 0 then
    insert into fine values (p_roll, sysdate, v_fine);
  end if;

  update borrower set status = 'returned' where roll_no = p_roll and nameofbook = p_book;
exception
  when no_data_found then
    raise ex_book_not_found;
  when ex_book_not_found then
    dbms_output.put_line('book not found');
end;
/
